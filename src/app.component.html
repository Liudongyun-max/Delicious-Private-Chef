<div class="min-h-screen flex flex-col bg-[#FDFBF7] text-stone-800 font-sans selection:bg-amber-100 selection:text-amber-900 overflow-x-hidden">
  
  <!-- Minimal Header (Responsive padding and sizing) -->
  <header class="pt-8 pb-6 md:pt-12 md:pb-10 lg:pt-16 lg:pb-12 text-center px-4 relative overflow-hidden">
    <!-- Decorative background element -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] md:w-[800px] lg:w-[1000px] h-[300px] md:h-[400px] bg-gradient-to-b from-amber-50/50 to-transparent rounded-full blur-3xl -z-10 opacity-60"></div>

    <div class="flex items-center justify-center gap-2 md:gap-3 lg:gap-4 mb-2 md:mb-4">
      <span class="text-3xl md:text-4xl lg:text-5xl drop-shadow-sm">ğŸ‘¨â€ğŸ³</span>
      <h1 class="text-3xl md:text-5xl lg:text-6xl font-serif font-bold text-stone-800 tracking-tight">ç¾å‘³ç§å¨</h1>
    </div>
    <p class="text-xs md:text-sm lg:text-base text-stone-500 max-w-lg mx-auto font-light tracking-wide px-4">
      Exclusive AI Culinary Assistant
    </p>
  </header>

  <!-- Search Section -->
  <div class="w-full max-w-xl md:max-w-2xl lg:max-w-3xl mx-auto mb-6 md:mb-12 relative z-10 px-4">
    <div class="bg-white p-1.5 md:p-2 rounded-full shadow-xl shadow-stone-200/40 border border-stone-100 flex items-center gap-2 transition-all duration-300 hover:shadow-2xl hover:shadow-stone-200/60 focus-within:ring-2 focus-within:ring-amber-100">
      <div class="pl-3 md:pl-5 text-stone-300 hidden sm:block">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <input 
        type="text" 
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
        (keyup.enter)="generate(searchQuery())"
        placeholder="æƒ³åƒä»€ä¹ˆï¼Ÿä¾‹å¦‚ï¼šæ¾é¼ æ¡‚é±¼..." 
        class="flex-grow bg-transparent border-none outline-none px-3 py-3 md:px-4 md:py-4 text-base md:text-lg text-stone-800 placeholder-stone-300 rounded-full font-light min-w-0"
        [disabled]="isLoading()"
      >
      <button 
        (click)="generate(searchQuery())"
        [disabled]="isLoading() || !searchQuery().trim()"
        class="bg-stone-800 hover:bg-black disabled:bg-stone-300 text-white px-4 md:px-8 py-3 md:py-4 rounded-full font-medium text-sm md:text-lg transition-all shadow-lg active:scale-95 flex items-center gap-2 whitespace-nowrap justify-center flex-shrink-0 min-w-[100px] md:min-w-[120px]"
      >
        @if (isLoading()) {
          <div class="flex items-center gap-2">
            <svg class="animate-spin h-4 w-4 md:h-5 md:w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-xs md:text-sm hidden sm:inline">{{ statusMessage() || 'ç”Ÿæˆä¸­...' }}</span>
          </div>
        } @else {
          ç”Ÿæˆ
        }
      </button>
    </div>
    
    <!-- Quick Recommendation Button -->
    <div class="mt-4 flex justify-center">
      <button 
        (click)="recommend()"
        [disabled]="isLoading()"
        class="text-stone-400 hover:text-amber-600 text-xs md:text-sm font-medium transition-all duration-300 flex items-center gap-2 px-4 py-2 rounded-full hover:bg-white hover:shadow-sm touch-manipulation group"
      >
        <span class="text-lg md:text-xl group-hover:rotate-12 transition-transform">ğŸ²</span> 
        <span>ä¸çŸ¥é“åƒä»€ä¹ˆï¼Ÿéšæœºæ¨è</span>
      </button>
    </div>

    @if (error()) {
      <div class="absolute -bottom-16 left-0 right-0 text-center px-4">
        <span class="bg-red-50 text-red-500 py-1.5 px-4 rounded-full text-xs md:text-sm border border-red-100 shadow-sm inline-flex items-center gap-2 max-w-full truncate">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 md:h-4 md:w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          <span class="truncate">{{ error() }}</span>
        </span>
      </div>
    }
  </div>

  <!-- Main Content Area -->
  <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Loading Skeleton -->
    @if (isLoading()) {
      <div class="animate-pulse max-w-4xl mx-auto bg-white rounded-[2rem] p-6 md:p-10 space-y-8 shadow-xl shadow-stone-100 border border-stone-50">
        <div class="h-56 md:h-80 lg:h-96 bg-stone-100 rounded-2xl w-full flex items-center justify-center">
             <div class="flex flex-col items-center gap-3 text-stone-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
                <span class="text-sm font-light tracking-widest">{{ statusMessage() }}</span>
             </div>
        </div>
        <div class="grid grid-cols-3 gap-4 border-b border-stone-100 pb-6">
          <div class="h-6 md:h-8 bg-stone-100 rounded mx-auto w-16 md:w-20"></div>
          <div class="h-6 md:h-8 bg-stone-100 rounded mx-auto w-16 md:w-20"></div>
          <div class="h-6 md:h-8 bg-stone-100 rounded mx-auto w-16 md:w-20"></div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 mt-4">
          <div class="lg:col-span-4 space-y-4">
             <div class="h-6 bg-stone-100 rounded w-1/2 mb-4"></div>
             <div class="h-4 bg-stone-100 rounded w-full"></div>
             <div class="h-4 bg-stone-100 rounded w-full"></div>
             <div class="h-4 bg-stone-100 rounded w-3/4"></div>
          </div>
          <div class="lg:col-span-8 space-y-4">
             <div class="h-6 bg-stone-100 rounded w-1/3 mb-4"></div>
             <div class="h-20 bg-stone-100 rounded w-full"></div>
             <div class="h-20 bg-stone-100 rounded w-full"></div>
          </div>
        </div>
      </div>
    }

    <!-- Result / Current View -->
    @if (!isLoading() && currentRecord(); as record) {
      <div class="animate-fade-in-up pb-10">
        <div class="flex justify-between items-center mb-4 md:mb-6 px-1 md:px-0">
          <button 
            (click)="currentRecord.set(null)" 
            class="text-stone-400 hover:text-stone-800 flex items-center gap-1.5 transition-colors text-xs md:text-sm font-medium uppercase tracking-widest touch-manipulation py-2 px-2 -ml-2 rounded hover:bg-stone-50"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
            Back to List
          </button>
        </div>

        <app-recipe-card 
          [recipe]="record.recipe" 
          [imageUrl]="record.imageUrl" 
          [isFavorite]="isRecordFavorite(record.id)"
          (toggleFavorite)="toggleFavorite(record)"
        />
      </div>
    }

    <!-- Empty State / Lists (History & Favorites) -->
    @if (!isLoading() && !currentRecord()) {
      <div class="pb-16">
        
        <!-- Tabs -->
        <div class="flex justify-center mb-8 md:mb-12">
           <div class="bg-stone-100 p-1 rounded-full inline-flex max-w-full overflow-hidden shadow-inner">
              <button 
                (click)="activeTab.set('history')"
                class="px-5 md:px-8 py-2 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 whitespace-nowrap touch-manipulation"
                [class.bg-white]="activeTab() === 'history'"
                [class.text-stone-800]="activeTab() === 'history'"
                [class.shadow-sm]="activeTab() === 'history'"
                [class.text-stone-500]="activeTab() !== 'history'"
              >
                Recent History
              </button>
              <button 
                (click)="activeTab.set('favorites')"
                class="px-5 md:px-8 py-2 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 flex items-center gap-2 whitespace-nowrap touch-manipulation"
                [class.bg-white]="activeTab() === 'favorites'"
                [class.text-amber-700]="activeTab() === 'favorites'"
                [class.shadow-sm]="activeTab() === 'favorites'"
                [class.text-stone-500]="activeTab() !== 'favorites'"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 md:h-4 md:w-4" [class.fill-amber-500]="activeTab() === 'favorites'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
                My Cookbook
              </button>
           </div>
        </div>

        @if (activeTab() === 'history') {
          <!-- History Grid -->
          @if (history().length > 0) {
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 lg:gap-8">
              @for (item of history(); track item.id) {
                <div 
                  (click)="loadFromHistory(item)"
                  class="bg-white rounded-xl md:rounded-2xl p-3 shadow-lg shadow-stone-100 hover:shadow-xl hover:shadow-stone-200 hover:-translate-y-1 transition-all duration-300 cursor-pointer group border border-stone-50 active:scale-98 touch-manipulation"
                >
                  <div class="relative h-36 md:h-44 mb-3 rounded-lg md:rounded-xl overflow-hidden bg-stone-100">
                     @if (item.imageUrl) {
                        <img [src]="item.imageUrl" [alt]="item.recipe.title" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                     } @else {
                        <div class="w-full h-full flex items-center justify-center text-3xl">ğŸ²</div>
                     }
                     <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                  </div>
                  <div class="px-1.5 pb-1">
                    <div class="flex justify-between items-start">
                      <h3 class="font-serif font-bold text-base md:text-lg text-stone-800 mb-1 group-hover:text-amber-700 transition-colors line-clamp-1">{{ item.recipe.title }}</h3>
                      @if (isRecordFavorite(item.id)) {
                        <span class="text-red-500 text-xs md:text-sm">â¤ï¸</span>
                      }
                    </div>
                    <p class="text-xs md:text-sm text-stone-500 line-clamp-2 leading-relaxed mb-2 h-8 md:h-10">{{ item.recipe.description }}</p>
                    <div class="flex items-center gap-2 text-[10px] md:text-xs text-stone-400 font-mono">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                       <span>{{ formatDate(item.timestamp) }}</span>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
             <div class="text-center py-20 opacity-50">
               <div class="text-4xl mb-4 grayscale">ğŸ¥—</div>
               <p class="text-stone-400 font-light text-sm md:text-base">No recent history yet.</p>
             </div>
          }
        } @else {
          <!-- Favorites Grid -->
          @if (favorites().length > 0) {
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 lg:gap-8">
              @for (item of favorites(); track item.id) {
                <div 
                  (click)="loadFromHistory(item)"
                  class="bg-white rounded-xl md:rounded-2xl p-3 shadow-lg shadow-stone-100 hover:shadow-xl hover:shadow-stone-200 hover:-translate-y-1 transition-all duration-300 cursor-pointer group border border-stone-50 ring-1 ring-amber-50 active:scale-98 touch-manipulation"
                >
                  <div class="relative h-36 md:h-44 mb-3 rounded-lg md:rounded-xl overflow-hidden bg-stone-100">
                     @if (item.imageUrl) {
                        <img [src]="item.imageUrl" [alt]="item.recipe.title" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                     } @else {
                        <div class="w-full h-full flex items-center justify-center text-3xl">ğŸ²</div>
                     }
                  </div>
                  <div class="px-1.5 pb-1">
                    <div class="flex justify-between items-start">
                       <h3 class="font-serif font-bold text-base md:text-lg text-stone-800 mb-1 line-clamp-1">{{ item.recipe.title }}</h3>
                       <span class="text-red-500 text-xs md:text-sm">â¤ï¸</span>
                    </div>
                    <p class="text-xs md:text-sm text-stone-500 line-clamp-2 leading-relaxed mb-2 h-8 md:h-10">{{ item.recipe.description }}</p>
                    <div class="flex justify-between items-center text-[10px] md:text-xs text-stone-400 font-mono">
                       <span>{{ item.recipe.difficulty }}</span>
                       <span>{{ item.recipe.time.totalMinutes }}m</span>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-20 opacity-50">
               <div class="text-4xl mb-4 grayscale">ğŸ’–</div>
               <p class="text-stone-400 font-light text-sm md:text-base">No favorites yet. Click the heart to save!</p>
             </div>
          }
        }

      </div>
    }
  </main>

  <footer class="mt-auto py-8 text-center text-stone-400 text-[10px] md:text-xs tracking-widest uppercase border-t border-stone-100">
    <p>Powered by Google Gemini 2.5 Flash & Imagen 4.0</p>
  </footer>
</div>