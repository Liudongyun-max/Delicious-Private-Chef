<div class="bg-white rounded-[1.5rem] md:rounded-[2rem] shadow-xl md:shadow-2xl shadow-stone-200/50 overflow-hidden max-w-6xl mx-auto my-2 md:my-6 border border-stone-100 relative group transition-all duration-300">
  
  <!-- Header Image Area -->
  <div class="relative h-64 md:h-80 lg:h-96 w-full overflow-hidden bg-stone-100">
    @if (imageUrl()) {
      <img [src]="imageUrl()" [alt]="recipe().title" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 animate-fade-in">
      <!-- Gradient Overlay -->
      <div class="absolute inset-0 bg-gradient-to-t from-stone-900/90 via-stone-900/40 to-transparent"></div>
    } @else {
      <!-- Loading State for Image -->
      <div class="w-full h-full flex flex-col items-center justify-center text-stone-400 gap-3 relative overflow-hidden">
        <!-- Subtle shimmer effect -->
        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"></div>
        
        <div class="animate-spin rounded-full h-6 w-6 md:h-8 md:w-8 border-2 border-stone-300 border-t-amber-500"></div>
        <span class="text-[10px] md:text-xs font-medium tracking-[0.2em] uppercase text-stone-500 animate-pulse">正在生成美味画面...</span>
      </div>
       <!-- Gradient Overlay (lighter for loading state) -->
       <div class="absolute inset-0 bg-gradient-to-t from-stone-900/50 to-transparent"></div>
    }
    
    <!-- Favorite Button (Floating) -->
    <button 
      (click)="toggleFavorite.emit()"
      class="absolute top-4 right-4 md:top-6 md:right-6 p-2.5 md:p-3 rounded-full backdrop-blur-md transition-all duration-300 hover:scale-110 active:scale-95 z-20 touch-manipulation shadow-lg shadow-black/10"
      [class.bg-white_90]="!isFavorite()"
      [class.bg-red-500]="isFavorite()"
      [class.text-white]="isFavorite()"
      [class.text-stone-600]="!isFavorite()"
      [class.bg-white]="!isFavorite()"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" [class.fill-current]="isFavorite()" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
      </svg>
    </button>

    <!-- Title Overlay -->
    <div class="absolute bottom-0 left-0 right-0 p-5 md:p-8 lg:p-10 text-white z-10">
      <div class="flex flex-col gap-1 md:gap-2">
        <span class="inline-block px-2.5 py-0.5 md:py-1 rounded-full bg-amber-500/20 backdrop-blur-sm border border-amber-500/30 text-amber-200 text-[10px] md:text-xs font-bold tracking-wider w-max uppercase">
          AI Private Kitchen
        </span>
        <h2 class="text-3xl md:text-4xl lg:text-5xl font-serif font-medium tracking-tight mb-1 md:mb-2 leading-tight drop-shadow-lg">{{ recipe().title }}</h2>
        <p class="text-stone-200 text-xs md:text-sm lg:text-base font-light max-w-2xl leading-relaxed line-clamp-2 md:line-clamp-none drop-shadow-md">{{ recipe().description }}</p>
      </div>
    </div>
  </div>

  <!-- Quick Stats Bar (Scrollable on very small screens) -->
  <div class="grid grid-cols-3 divide-x divide-stone-100 border-b border-stone-100 bg-white sticky top-0 z-10">
    <div class="p-3 md:p-4 text-center">
      <div class="text-[10px] md:text-xs text-stone-400 uppercase tracking-widest mb-1">Total Time</div>
      <div class="font-serif text-base md:text-lg lg:text-xl text-stone-700 leading-none">{{ recipe().time.totalMinutes }}<span class="text-[10px] md:text-xs text-stone-400 ml-1 font-sans">min</span></div>
    </div>
    <div class="p-3 md:p-4 text-center">
      <div class="text-[10px] md:text-xs text-stone-400 uppercase tracking-widest mb-1">Servings</div>
      <div class="font-serif text-base md:text-lg lg:text-xl text-stone-700 leading-none">{{ recipe().servings }}<span class="text-[10px] md:text-xs text-stone-400 ml-1 font-sans">ppl</span></div>
    </div>
    <div class="p-3 md:p-4 text-center">
      <div class="text-[10px] md:text-xs text-stone-400 uppercase tracking-widest mb-1">Difficulty</div>
      <div class="font-serif text-base md:text-lg lg:text-xl text-stone-700 leading-none">{{ recipe().difficulty }}</div>
    </div>
  </div>

  <!-- Content Grid -->
  <div class="p-5 md:p-8 lg:p-10 grid lg:grid-cols-12 gap-8 lg:gap-12">
    
    <!-- Left Column: Ingredients -->
    <div class="lg:col-span-4 space-y-6 md:space-y-8">
      <section>
        <h3 class="text-base md:text-lg font-serif text-stone-800 mb-4 md:mb-6 flex items-center gap-3">
          <span class="w-6 md:w-8 h-[1px] bg-amber-500"></span>
          准备食材
        </h3>
        <ul class="space-y-3 md:space-y-4">
          @for (item of recipe().ingredients; track item.name) {
            <li class="flex items-baseline justify-between group/item text-sm md:text-base">
              <div class="flex-1 border-b border-stone-100 pb-1.5 md:pb-2 mr-4 group-hover/item:border-amber-200 transition-colors">
                <span class="font-medium text-stone-700 block">{{ item.name }}</span>
                @if (item.substitute) {
                   <span class="block text-[10px] text-stone-400 italic mt-0.5">或 {{ item.substitute }}</span>
                }
              </div>
              <div class="flex-shrink-0 text-right pb-1.5 md:pb-2 border-b border-stone-100 min-w-[3rem]">
                <span class="text-amber-600 font-medium whitespace-nowrap">{{ item.amount }}</span>
              </div>
            </li>
          }
        </ul>
      </section>

      <!-- Nutrition Card -->
      @if (recipe().nutrition; as nut) {
        <div class="bg-stone-50/80 rounded-xl md:rounded-2xl p-4 md:p-6 border border-stone-100 mt-6">
          <h3 class="text-[10px] md:text-xs font-bold text-stone-400 uppercase tracking-widest mb-3 md:mb-4">Nutrition Facts</h3>
          <div class="space-y-2 md:space-y-3 text-xs md:text-sm">
            <div class="flex justify-between items-center">
              <span class="text-stone-500">Calories</span>
              <span class="font-mono font-medium text-stone-800">{{ nut.calories }}</span>
            </div>
            <div class="h-px bg-stone-200"></div>
            <div class="flex justify-between items-center">
              <span class="text-stone-500">Protein</span>
              <span class="font-mono font-medium text-stone-800">{{ nut.protein }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-stone-500">Carbs</span>
              <span class="font-mono font-medium text-stone-800">{{ nut.carbs }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-stone-500">Fat</span>
              <span class="font-mono font-medium text-stone-800">{{ nut.fat }}</span>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Right Column: Steps -->
    <div class="lg:col-span-8 space-y-8 md:space-y-10">
      <section>
        <h3 class="text-base md:text-lg font-serif text-stone-800 mb-4 md:mb-6 flex items-center gap-3">
          <span class="w-6 md:w-8 h-[1px] bg-amber-500"></span>
          烹饪步骤
        </h3>
        
        <!-- Adaptive Timeline -->
        <div class="space-y-6 md:space-y-8 relative before:absolute before:left-[15px] md:before:left-[19px] before:top-4 before:bottom-4 before:w-[2px] before:bg-stone-100">
          @for (step of recipe().steps; track step.step) {
            <div class="relative flex gap-4 md:gap-6 group/step">
              <!-- Step Number Bubble -->
              <div class="flex-shrink-0 z-10">
                <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-white border-2 border-amber-500 text-amber-600 flex items-center justify-center font-serif font-bold text-sm md:text-lg shadow-sm group-hover/step:scale-110 transition-transform duration-300">
                  {{ step.step }}
                </div>
              </div>
              
              <!-- Step Content -->
              <div class="flex-grow pt-1">
                <p class="text-stone-600 leading-relaxed mb-2 md:mb-3 text-sm md:text-base">{{ step.text }}</p>
                <div class="flex flex-wrap gap-2 md:gap-3">
                  @if (step.heatLevel) {
                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-stone-100 text-stone-600 text-[10px] md:text-xs font-medium">
                      <span class="w-1 md:w-1.5 h-1 md:h-1.5 rounded-full bg-red-400"></span>
                      {{ step.heatLevel }}
                    </span>
                  }
                  @if (step.timeMinutes > 0) {
                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-stone-100 text-stone-600 text-[10px] md:text-xs font-medium">
                      <span class="w-1 md:w-1.5 h-1 md:h-1.5 rounded-full bg-blue-400"></span>
                      {{ step.timeMinutes }} min
                    </span>
                  }
                </div>
                @if (step.tips) {
                   <div class="mt-2 md:mt-3 text-xs md:text-sm text-stone-500 italic bg-amber-50/50 p-3 rounded-lg border-l-2 border-amber-300">
                     Tip: {{ step.tips }}
                   </div>
                }
              </div>
            </div>
          }
        </div>
      </section>

      @if (recipe().tips && recipe().tips.length > 0) {
        <section class="bg-stone-800 text-stone-300 rounded-xl md:rounded-2xl p-6 md:p-8 relative overflow-hidden">
          <div class="absolute -right-10 -top-10 w-32 h-32 md:w-40 md:h-40 bg-stone-700 rounded-full opacity-20 blur-3xl"></div>
          <h3 class="text-white font-serif text-base md:text-lg mb-3 md:mb-4 relative z-10">Chef's Secret Keys</h3>
          <ul class="space-y-2 md:space-y-3 relative z-10">
            @for (tip of recipe().tips; track $index) {
              <li class="flex items-start gap-2 md:gap-3 text-xs md:text-sm font-light leading-relaxed">
                <span class="text-amber-500 mt-1">✦</span>
                {{ tip }}
              </li>
            }
          </ul>
        </section>
      }
    </div>
  </div>
</div>